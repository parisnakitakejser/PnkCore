# CKS Exam Prep: Image Vulnerability Scanning With Trivy

This lab shows how to install Trivy, scan container images, and validate
results with a simple demo workload. In the CKS exam environment, Trivy is
already installed and ready to use.

Official docs: https://trivy.dev/docs/latest/getting-started/installation/#debianubuntu-official

## 1) Install Trivy (Ubuntu/Debian)

```bash
sudo apt-get install -y wget gnupg
wget -qO - https://aquasecurity.github.io/trivy-repo/deb/public.key \
  | gpg --dearmor \
  | sudo tee /usr/share/keyrings/trivy.gpg > /dev/null
echo "deb [signed-by=/usr/share/keyrings/trivy.gpg] https://aquasecurity.github.io/trivy-repo/deb generic main" \
  | sudo tee /etc/apt/sources.list.d/trivy.list
sudo apt-get update
sudo apt-get install -y trivy
```

Verify:

```bash
trivy --version
```

## 2) Deploy the demo workload

This manifest deploys three images:
`nginx:1.25.2`, `httpd:2.4.57`, and `alpine:3.18`.

```bash
kubectl apply -f deployment.yaml
```

Cleanup:

```bash
kubectl delete -f deployment.yaml
```

## 3) Scan the images

Scan each image and filter for the CVE from the lab:

```bash
trivy image nginx:1.25.2 | grep "CVE-2023-45853"
trivy image httpd:2.4.57 | grep "CVE-2023-45853"
trivy image alpine:3.18 | grep "CVE-2023-45853"
```

Expected result: the CVE shows up in **nginx** and **httpd**, but not in **alpine**.

## 4) Useful Trivy flags (quick recall)

```bash
trivy image --severity HIGH,CRITICAL nginx:1.25.2
trivy image --ignore-unfixed nginx:1.25.2
trivy image --format json nginx:1.25.2 > report.json
```

## Exam notes

- Trivy is already installed in the CKS exam environment.
- If you just need to prove a specific CVE, filter output with `grep` to save time.
- Scanning local images does not require a cluster; you can do it directly on the node.
